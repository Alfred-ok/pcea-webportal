import{j as e,r as c}from"./index--2Vg46XJ.js";import{C as W,d as _}from"./index-Bp6JkL8A.js";import{F as M,G as w,H as P,c as D,d as V,e as ee,o as se,p as te,q as O,r as L,s as ne,t as h}from"./DefaultLayout-JRVaWF0p.js";import{E as re,a as oe}from"./jspdf.plugin.autotable-xBXH9STM.js";import{l as le,b as G,c as Z,d as de,e as ae}from"./logo1-B-TheImU.js";import{C as E,a as b}from"./CForm-uSoNT2u_.js";import{C as $}from"./CCardTitle-Bhw-tENH.js";import{C as ce,a as H}from"./CRow-BUZD3U73.js";import{C as B,a as n}from"./CListGroupItem-Dl75QF8E.js";import{a as f}from"./CFormInput-DcpM5UbD.js";import{C as me}from"./CAlert-CwhgRHPq.js";import{C as ie}from"./CModalTitle-Bc9MZI4H.js";import{C as he}from"./CFormTextarea-CBhWhc4W.js";import"./index.esm-CI-HiMCL.js";import"./CCloseButton-CvX7nGj0.js";import"./cil-user-Ddrdy7PS.js";import"./typeof-QjJsDpFa.js";const ue=({viewMoreVisibleData:s})=>{console.log(s);const j={width:"300px",height:"300px",backgroundImage:`url("data:image/jpeg;base64,${s.passportPhoto}")`,backgroundSize:"contain",marginTop:"8px",objectFit:"contain",overflow:"hidden"},y=async()=>{const o=new re("p","mm","a4"),N=10,g=o.internal.pageSize.getWidth(),u=d=>new Promise((m,i)=>{const a=new Image;a.crossOrigin="Anonymous",a.src=d,a.onload=()=>{const r=document.createElement("canvas");r.width=a.width,r.height=a.height,r.getContext("2d").drawImage(a,0,0),m(r.toDataURL("image/png"))},a.onerror=r=>i(r)});try{const d=await u(le),m=30,i=30,a=(g-m)/2;let r=N;o.addImage(d,"PNG",a,r,m,i),r+=i+10,o.setFontSize(14),o.setFont("helvetica","bold"),o.text("PCEA ZIMMERMAN MEMBER REPORT",g/2,r,{align:"center"}),r+=5,o.setLineWidth(.5),o.line(20,r,190,r),o.setFont("helvetica","bold"),o.setFontSize(20);const T=g/2,p=r+10;o.text(s.fullName||"Member",T,p,{align:"center"}),r=p+5,o.setLineWidth(.5),o.line(20,r,190,r),r+=10,oe(o,{startY:r+5,head:[["Field","Value"]],body:[["Email",s.email||"-"],["District",s.district||"-"],["Spouse Name",s.spouseName||"-"],["Spouse ZP Number",s.spouseZPNumber||"-"],["Marital Status",s.maritalStatus||"-"],["National ID",s.nationalID||"-"],["Mobile Number",s.mobileNumber||"-"],["ZP Number",s.zPNumber||"-"],["Card Serial Number",s.cardSerialNumber||"-"],["Disability Type",s.disabilityType||"-"],["Disabled",s.disabled||"-"],["ID",s.id||"-"],["Holy Communion Status",s.holyCommunionStatus||"-"],["Gender",s.gender||"-"],["Year Of Birth",s.dob||"-"],["EPC Number",s.ePCNumber||"-"]],theme:"grid",headStyles:{fillColor:[41,128,185],textColor:255},alternateRowStyles:{fillColor:[240,240,240]}}),o.save("CV.pdf")}catch(d){console.error("Error loading images:",d)}};return e.jsx("div",{className:"container mt-2",children:e.jsxs(E,{className:"p-4 shadow-lg",children:[e.jsxs(W,{className:"bg-primary text-white text-center",children:[e.jsx($,{className:"h3 mb-0",children:s.fullName}),e.jsx("p",{children:"Member"})]}),e.jsxs(b,{children:[e.jsxs(ce,{children:[e.jsxs(H,{md:4,children:[e.jsx("h5",{children:"Contact Information"}),e.jsxs(B,{children:[s.email&&e.jsxs(n,{children:[e.jsx(M,{})," Email: ",s.email]}),s.telephone&&e.jsxs(n,{children:[e.jsx(w,{})," Telephone: ",s.telephone]}),s.address&&e.jsxs(n,{children:[e.jsx(P,{})," Address: ",s.address]}),s.district&&e.jsxs(n,{children:[e.jsx(P,{})," District: ",s.district]}),s.guardianPhone&&e.jsxs(n,{children:[e.jsx(P,{})," Guardian Phone: ",s.guardianPhone]}),s.passportPhoto&&e.jsxs(n,{children:[e.jsx(P,{}),"Passport :",e.jsx("div",{style:j})]})]})]}),e.jsxs(H,{md:8,children:[e.jsx("h5",{children:"Family"}),e.jsx(E,{className:"mb-3",children:e.jsx(b,{children:e.jsxs(B,{flush:!0,children:[s.spouseName&&e.jsxs(n,{children:[e.jsx("strong",{children:"Spouse Name :"})," ",s.spouseName]}),s.spouseZPNumber&&e.jsxs(n,{children:[e.jsx("strong",{children:"Spouse ZpNumber :"})," ",s.spouseZPNumber]}),s.maritalStatus&&e.jsxs(n,{children:[e.jsx("strong",{children:"Marital Status :"})," ",s.maritalStatus]}),s.marriageType&&e.jsxs(n,{children:[e.jsx("strong",{children:"Marriage Type :"})," ",s.marriageType]}),s.teenager&&e.jsxs(n,{children:[e.jsx("strong",{children:"Teenager :"})," ",s.teenager]})]})})}),e.jsx("h5",{children:"Other Details"}),e.jsx(E,{className:"mb-3",children:e.jsx(b,{children:e.jsxs(B,{flush:!0,children:[s.nationalID&&e.jsxs(n,{children:[e.jsx("strong",{children:"National ID"})," ",s.nationalID]}),s.mobileNumber&&e.jsxs(n,{children:[e.jsx("strong",{children:"Mobile Number"})," ",s.mobileNumber]}),s.zPNumber&&e.jsxs(n,{children:[e.jsx("strong",{children:"ZP Number"})," ",s.zPNumber]}),s.cardSerialNumber&&e.jsxs(n,{children:[e.jsx("strong",{children:"Card Serial Number"})," ",s.cardSerialNumber]}),s.baptized&&e.jsxs(n,{children:[e.jsx("strong",{children:"Baptised"})," ",s.baptized]}),s.baptizedBy&&e.jsxs(n,{children:[e.jsx("strong",{children:"Baptised By:"})," ",s.baptizedBy]}),s.comments&&e.jsxs(n,{children:[e.jsx("strong",{children:"Comments :"})," ",s.comments]}),s.communicant&&e.jsxs(n,{children:[e.jsx("strong",{children:"Communicant :"})," ",s.communicant]}),s.communicantNumber&&e.jsxs(n,{children:[e.jsx("strong",{children:"Communicant Number:"})," ",s.communicantNumber]}),s.confirmationLocation&&e.jsxs(n,{children:[e.jsx("strong",{children:"Location :"})," ",s.confirmationLocation]}),s.confirmedBy&&e.jsxs(n,{children:[e.jsx("strong",{children:"Confirmed By :"})," ",s.confirmedBy]}),s.dob&&e.jsxs(n,{children:[e.jsx("strong",{children:"Date Of Baptism :"})," ",s.dob]}),s.dateOfConfirmation&&e.jsxs(n,{children:[e.jsx("strong",{children:"Date Of Confirmation :"})," ",s.dateOfConfirmation]}),s.disabilityType&&e.jsxs(n,{children:[e.jsx("strong",{children:"Disability Type :"})," ",s.disabilityType]}),s.disabled&&e.jsxs(n,{children:[e.jsx("strong",{children:"Disabled :"})," ",s.disabled]}),s.id&&e.jsxs(n,{children:[e.jsx("strong",{children:"Id :"})," ",s.id]}),s.holyCommunionStatus&&e.jsxs(n,{children:[e.jsx("strong",{children:"Holy Communion status :"})," ",s.holyCommunionStatus]}),s.membershipType&&e.jsxs(n,{children:[e.jsx("strong",{children:"Membership Type :"})," ",s.membershipType]}),s.gender&&e.jsxs(n,{children:[e.jsx("strong",{children:"Gender :"})," ",s.gender]}),s.teenager&&e.jsxs(n,{children:[e.jsx("strong",{children:"Teenager :"})," ",s.teenager]}),s.yearOfBirth&&e.jsxs(n,{children:[e.jsx("strong",{children:"Year Of Birth :"})," ",s.yearOfBirth]}),s.yearOfJoining&&e.jsxs(n,{children:[e.jsx("strong",{children:"Year Of Joining :"})," ",s.yearOfJoining]}),s.zone&&e.jsxs(n,{children:[e.jsx("strong",{children:"Zone :"})," ",s.zone]}),s.ePCNumber&&e.jsxs(n,{children:[e.jsx("strong",{children:"EPC Number :"})," ",s.ePCNumber]})]})})})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(f,{color:"primary",onClick:y,className:"mt-3",children:"Download CV"})})]})]})})},ke=()=>{const[s,I]=c.useState("movedToEvangelist"),[j,y]=c.useState({movedToPastoral:[],movedToEvangelist:[],movedToCatechism:[]}),[o,N]=c.useState(!1),[g,u]=c.useState(!1),[d,m]=c.useState(""),[i,a]=c.useState(null),[r,T]=c.useState(""),[p,Y]=c.useState(!0),[J,A]=c.useState(!1),[k,X]=c.useState(),z=localStorage.getItem("roleId");c.useEffect(()=>{const t=async(l,x)=>{N(!0);try{const S=localStorage.getItem("token");if(!S)throw new Error("No token found");const C=await fetch(x,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`}});if(!C.ok)throw new Error(`HTTP error! Status: ${C.status}`);const R=await C.json();y(Q=>({...Q,[l]:Array.isArray(R)?R:[]}))}catch(S){console.error(`Error fetching ${l} members:`,S),y(C=>({...C,[l]:[]}))}finally{N(!1)}};t("movedToPastoral","http://192.168.13.244:8594/api/registrations/RejoiningMemberStatus?Status=8"),t("movedToEvangelist","http://192.168.13.244:8594/api/registrations/RejoiningMemberStatus?Status=13"),t("movedToCatechism","http://192.168.13.244:8594/api/registrations/RejoiningMemberStatus?Status=9")},[p]);const F=z=="1"?"":"Approval",q={movedToPastoral:["Full Name","District","Gender","ZpNumber","Telephone",F],movedToEvangelist:["Full Name","District","Gender","ZpNumber","Telephone",F],movedToCatechism:["Full Name","District","Gender","ZpNumber","Telephone",F]},U=t=>{t&&(X(t),A(!0))},v=t=>{const l=j[s].find(x=>x.id===t);l&&(a(l),u(!0))},K=async()=>{if(!i||!d){alert("Please select a registration status.");return}const t={id:i.id,status:Number(d),comments:r};console.log(t);try{const l=localStorage.getItem("token");if(!l)throw new Error("No token found");const x=await fetch("http://192.168.13.244:8594/api/registrations/approvetransfer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(t)});if(!x.ok)throw new Error("Failed to update status");console.log(x),alert("Status updated successfully!"),u(!1),Y(!p)}catch(l){console.error("Error updating status:",l),alert("Error updating status. Please try again.")}};return console.log(j),e.jsxs(E,{className:"mb-4",children:[e.jsx(W,{children:e.jsx($,{children:e.jsxs(me,{color:"primary",variant:"solid",style:{display:"flex"},children:[e.jsx(_,{size:40,className:"nav-icon",style:{marginRight:"10px"}}),e.jsx("h3",{children:"Readmission"})]})})}),e.jsxs(b,{children:[e.jsx(D,{variant:"tabs",children:["movedToEvangelist","movedToPastoral","movedToCatechism"].map(t=>e.jsx(V,{children:e.jsx(ee,{active:s===t,onClick:()=>I(t),style:{cursor:"pointer",fontWeight:"bold"},children:t==="movedToEvangelist"?"Moved to Evangelist":t==="movedToPastoral"?"Moved to Pastoral":"Moved to Catechism"})},t))}),o?e.jsxs("div",{className:"text-center",children:[e.jsx("l-zoomies",{size:"120",stroke:"5","bg-opacity":"0.1",speed:"1.4",color:"blue"}),e.jsx("p",{children:"Loading data..."})]}):e.jsxs(se,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(te,{children:e.jsxs(O,{color:"primary",children:[e.jsx(L,{style:{color:"blue",fontWeight:"bold"},children:"No."}),q[s].map(t=>e.jsx(L,{style:{color:"blue",fontWeight:"bold"},children:t},t))]})}),e.jsx(ne,{children:j[s].map((t,l)=>e.jsxs(O,{children:[e.jsx(h,{children:l+1}),e.jsx(h,{children:t.fullName}),e.jsx(h,{children:t.district}),e.jsx(h,{children:t.gender}),e.jsx(h,{children:t.zPNumber}),e.jsx(h,{children:t.mobileNumber}),(s==="movedToPastoral"||s==="movedToEvangelist"||s==="movedToCatechism")&&e.jsx(h,{children:z=="1"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(f,{style:{color:"white",fontWeight:"bold",marginRight:"5px"},color:"success",onClick:()=>v(t.id),children:"Approve"}),e.jsx(f,{style:{color:"white",fontWeight:"bold"},color:"primary",onClick:()=>U(t),children:"View More"})]})})]},t.id))})]}),e.jsxs(G,{visible:J,onClose:()=>A(!1),"aria-labelledby":"LiveDemoExampleLabel",size:"xl",alignment:"center",backdrop:"static",children:[e.jsx(Z,{}),k&&e.jsx(ue,{viewMoreVisibleData:k})]}),e.jsxs(G,{visible:g,onClose:()=>u(!1),children:[e.jsx(Z,{children:e.jsx(ie,{children:"Approval Details"})}),e.jsx(de,{style:{maxHeight:"60vh",overflowY:"auto"},children:i&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"registrationStatus",className:"mt-2",style:{fontWeight:"bold",color:"blue"},children:"Approve Registration:"}),s==="movedToEvangelist"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:d,onChange:t=>m(t.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"8",children:"Moved To Pastoral"})]}):s==="movedToPastoral"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:d,onChange:t=>m(t.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"10",children:"Move to Full Member awaiting Admission"}),e.jsx("option",{value:"9",children:"Moved To Catechism"})]}):s==="movedToCatechism"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:d,onChange:t=>m(t.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"10",children:"Move to Full Member awaiting Admission"})]}):e.jsx(e.Fragment,{children:"Action Disabled"}),e.jsx(he,{className:"mt-2",placeholder:"Add a comment",value:r,onChange:t=>T(t.target.value)})]})}),e.jsxs(ae,{children:[e.jsx(f,{color:"secondary",onClick:()=>u(!1),children:"Close"}),e.jsx(f,{color:"success",onClick:K,children:"Confirm"})]})]})]})]})};export{ke as default};
