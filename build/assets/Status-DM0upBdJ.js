import{r as n,j as e,C as B}from"./index-C94lwiJv.js";import{E as ce,a as de}from"./jspdf.plugin.autotable-C9i-e47c.js";import{b as he,c as ue,d as ge,e as xe,l as me}from"./logo1-_GWK0zuy.js";import{C as ie,a as fe}from"./CForm-By0H7RBh.js";import{C as je,a as be}from"./index-CynBYxOh.js";import{b as pe,a as C}from"./CFormInput-ChrqK6Lh.js";import{o as Y,p as Z,q as M,r as i,s as $,t as a,l as ye,m as D,n as Ce}from"./DefaultLayout-BFpOW43o.js";import{C as Me}from"./CAlert-h_oXZGtT.js";import{C as ve,a as we,b as ae,c as le}from"./CTabList-Cz2zYZrj.js";import"./typeof-QjJsDpFa.js";import"./CCloseButton-fePu8NsK.js";import"./index.esm-DV_CLorw.js";import"./cil-user-Ddrdy7PS.js";import"./getTransitionDurationFromElement-Cpu4p4hx.js";const Se=""+new URL("oprah-winfrey-signature-signaturely-BDYumHvZ.png",import.meta.url).href;function Ne(){const[u,U]=n.useState([]),[v,f]=n.useState([]),[G,W]=n.useState(!0),[R,w]=n.useState(""),[j,g]=n.useState(1),[d,V]=n.useState("all"),N=300,[b,K]=n.useState(""),[X,E]=n.useState(!1),[h,_]=n.useState([]),[q,A]=n.useState(!1),[J,Q]=n.useState(),k=async()=>{const t=new ce,s=t.internal.pageSize.getWidth(),o=t.internal.pageSize.getHeight(),r=20,x=15,I=m=>new Promise((L,p)=>{const l=new Image;l.crossOrigin="Anonymous",l.src=m,l.onload=()=>{const c=document.createElement("canvas");c.width=l.width,c.height=l.height,c.getContext("2d").drawImage(l,0,0),L(c.toDataURL("image/png"))},l.onerror=c=>p(c)});try{A(!0);const m=await I(me),L=await I(Se),p=40,l=40,c=(s-p)/2;t.addImage(m,"PNG",c,x,p,l);const y=x+l,F=15;t.setFontSize(14),t.text("PCEA ZIMMERMAN HOLY COMMUNION ATTENDANCE REPORT",s/2,y+F,{align:"center"}),t.setFontSize(11),t.setFont("helvetica"),t.text("Name: "+J,s/2,y+F+8,{align:"center"});const re=y+F+10;de(t,{startY:re,margin:{left:r,right:r},head:[["Service","Serial Number","Officiating Minister","Date"]],body:h.map(S=>[H(S.createdDate),S.serialNumber,S.officiatingMinister,S.datex]),theme:"striped"});const oe=15,ne=o-70;t.setFontSize(12),t.text("Authorized by: "+(h.length>0?h[0].officiatingMinister:"N/A"),s/2,ne+oe+8,{align:"center"}),t.setFontSize(11),t.setFont("helvetica","italic"),t.setTextColor(128,128,128),t.text("The above is a true record without alteration",s/2,o-35,{align:"center"});const O=15;t.setFillColor(19,86,175),t.rect(0,o-O,s,O,"F"),t.setTextColor(255,255,255),t.setFontSize(10),t.text("Generated on: "+new Date().toLocaleDateString(),r,o-5),t.text("© PCEA ZIMMERMAN CHURCH",s-60,o-5),t.save("PCEA ZIMMERMAN HOLY COMMUNION ATTENDANCE REPORT.pdf"),A(!1)}catch(m){console.error("Error loading images:",m),A(!1)}};n.useEffect(()=>{(async()=>{W(!0),w("");try{const s=localStorage.getItem("token");if(!s)throw new Error("No token found");const o=await fetch("http://192.168.12.245:8594/api/registrations/Getmemberhistorycommunion",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const r=await o.json();console.log("API Response:",r),U(Array.isArray(r)?r:[]),f(Array.isArray(r)?r:[])}catch(s){console.error("Error fetching data:",s),w(s.message)}finally{W(!1)}})()},[]),n.useEffect(()=>{let t=u;d!=="all"&&(t=t.filter(s=>s.status.toLowerCase()===d)),b&&(t=t.filter(s=>s.zpnumber.includes(b))),f(t),g(1)},[d,b,u]),n.useEffect(()=>{f(d==="all"?u:u.filter(t=>t.status.toLowerCase()===d)),g(1)},[d,u]);const ee=v.length,P=Math.ceil(ee/N),z=j*N,T=z-N,te=v.slice(T,z),se=async t=>{Q(t.fullName);try{const s=localStorage.getItem("token");if(!s)throw new Error("No authentication token found");const o=await fetch(`http://192.168.12.245:8594/api/registrations/Membercommunionhistory?zp=${t.zpnumber}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const r=await o.json();console.log("Modal API Response:",r),_(Array.isArray(r)?r:[]),E(!0)}catch(s){console.error("Error fetching member details:",s),w(s.message)}},H=t=>{const s=new Date(t),o=s.getDay(),r=s.getHours(),x=s.getMinutes();if(o===0){if(r>=7&&(r<10||r===10&&x===0))return"First Service";if(r===10&&x>0||r>10&&r<14)return"Second Service"}return o===3&&r>=17&&r<21?"Mid-Week Service":o===1&&r>=18&&r<21?"Youth Service":"Special Service"};return e.jsxs(ie,{className:"mb-4",children:[e.jsx(je,{children:e.jsx("h3",{style:{color:"blue"},children:"Member Status"})}),e.jsxs(fe,{children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-end gap-3",children:[e.jsx(pe,{style:{width:"250px"},placeholder:"Search by ZP Number",value:b,onChange:t=>K(t.target.value)}),e.jsxs(be,{style:{width:"200px"},value:d,onChange:t=>V(t.target.value),children:[e.jsx("option",{style:{fontWeight:"bold"},value:"all",children:"All Members"}),e.jsx("option",{style:{fontWeight:"bold"},value:"active",children:"Active"}),e.jsx("option",{style:{fontWeight:"bold"},value:"inactive",children:"Inactive"})]})]}),G?e.jsxs("div",{className:"text-center",children:[e.jsx(B,{color:"primary"}),e.jsx("p",{children:"Loading members..."})]}):R?e.jsxs("p",{style:{color:"red",textAlign:"center"},children:["Error: ",R]}):v.length===0?e.jsx("p",{style:{textAlign:"center"},children:"Oops seems there are no records."}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"No."}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Full Name"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Mobile Number"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"ZP Number"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Status"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Action"})]})}),e.jsx($,{children:te.map((t,s)=>e.jsxs(M,{children:[e.jsx(a,{style:{fontWeight:"bold",color:"blue"},children:T+s+1}),e.jsx(a,{children:t.fullName}),e.jsx(a,{children:t.mobileNumber}),e.jsx(a,{children:t.zpnumber}),e.jsx(a,{style:{color:t.status.toLowerCase()==="inactive"?"red":"green",fontWeight:"bold"},children:t.status}),e.jsx(a,{children:e.jsx(C,{style:{color:"white",fontWeight:"bold"},color:"success",onClick:()=>se(t),children:"View More"})})]},T+s+1))})]}),e.jsxs(he,{size:"lg",visible:X,onClose:()=>E(!1),children:[e.jsx(ue,{children:e.jsx("strong",{children:"Member History Details"})}),e.jsxs(ge,{style:{maxHeight:"auto",overflowY:"auto"},children:[h.length>0?e.jsx("div",{className:"mb-3",children:q?e.jsxs(C,{disabled:!0,color:"success",style:{color:"#fff"},onClick:k,className:"me-2",children:[e.jsx(B,{size:"sm",color:"light",style:{marginRight:"4px"}}),"Download PDF"]}):e.jsx(C,{color:"success",style:{color:"#fff"},onClick:k,className:"me-2",children:"Download PDF"})}):e.jsx(e.Fragment,{}),h.length>0?e.jsxs(Y,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(i,{children:e.jsx("strong",{children:"Type"})}),e.jsx(i,{children:e.jsx("strong",{children:"Serial Number"})}),e.jsx(i,{children:e.jsx("strong",{children:"Date"})}),e.jsx(i,{children:e.jsx("strong",{children:"Officiating Minister"})}),e.jsx(i,{children:e.jsx("strong",{children:"Service"})})]})}),e.jsx($,{children:h.map((t,s)=>e.jsxs(M,{children:[e.jsx(a,{children:t.type}),e.jsx(a,{children:t.serialNumber}),e.jsx(a,{children:t.datex}),e.jsx(a,{children:t.officiatingMinister}),e.jsx(a,{children:H(t.createdDate)})]},s))})]}):e.jsx("p",{children:"No history records found."})]}),e.jsx(xe,{children:e.jsx(C,{color:"secondary",onClick:()=>E(!1),children:"Close"})})]}),e.jsxs(ye,{align:"center",children:[e.jsx(D,{style:{cursor:"pointer",fontWeight:"bold"},disabled:j===1,onClick:()=>g(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:P}).map((t,s)=>e.jsx(D,{style:{cursor:"pointer",fontWeight:"bold"},active:j===s+1,onClick:()=>g(s+1),children:s+1},s)),e.jsx(D,{style:{cursor:"pointer",fontWeight:"bold"},disabled:j===P,onClick:()=>g(t=>Math.min(t+1,P)),children:"Next"})]})]})]})]})}function Ee(){const[u,U]=n.useState([]),[v,f]=n.useState([]),[G,W]=n.useState(!0),[R,w]=n.useState(""),[j,g]=n.useState(1),[d,V]=n.useState("all"),N=300,[b,K]=n.useState(""),[X,E]=n.useState(!1),[h,_]=n.useState([]),[q,A]=n.useState(!1),[J,Q]=n.useState(),k=async()=>{const t=new ce,s=t.internal.pageSize.getWidth(),o=t.internal.pageSize.getHeight(),r=20,x=15,I=m=>new Promise((L,p)=>{const l=new Image;l.crossOrigin="Anonymous",l.src=m,l.onload=()=>{const c=document.createElement("canvas");c.width=l.width,c.height=l.height,c.getContext("2d").drawImage(l,0,0),L(c.toDataURL("image/png"))},l.onerror=c=>p(c)});try{A(!0);const m=await I(me),L=await I(Se),p=40,l=40,c=(s-p)/2;t.addImage(m,"PNG",c,x,p,l);const y=x+l,F=15;t.setFontSize(14),t.text("PCEA ZIMMERMAN SERVICE ATTENDANCE REPORT",s/2,y+F,{align:"center"}),t.setFontSize(11),t.setFont("helvetica"),t.text("Name: "+J,s/2,y+F+8,{align:"center"});const re=y+F+10;de(t,{startY:re,margin:{left:r,right:r},head:[["Service","Serial Number","Officiating Minister","Date"]],body:h.map(S=>[H(S.createdDate),S.serialNumber,S.officiatingMinister,S.datex]),theme:"striped"});const oe=15,ne=o-70;t.setFontSize(12),t.text("Authorized by: "+(h.length>0?h[0].officiatingMinister:"N/A"),s/2,ne+oe+8,{align:"center"}),t.setFontSize(11),t.setFont("helvetica","italic"),t.setTextColor(128,128,128),t.text("The above is a true record without alteration",s/2,o-35,{align:"center"});const O=15;t.setFillColor(19,86,175),t.rect(0,o-O,s,O,"F"),t.setTextColor(255,255,255),t.setFontSize(10),t.text("Generated on: "+new Date().toLocaleDateString(),r,o-5),t.text("© PCEA ZIMMERMAN CHURCH",s-60,o-5),t.save("PCEA ZIMMERMAN SERVICE ATTENDANCE REPORT.pdf"),A(!1)}catch(m){console.error("Error loading images:",m),A(!1)}};n.useEffect(()=>{(async()=>{W(!0),w("");try{const s=localStorage.getItem("token");if(!s)throw new Error("No token found");const o=await fetch("http://192.168.12.245:8594/api/registrations/Getmemberhistoryservice",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const r=await o.json();console.log("API Response:",r),U(Array.isArray(r)?r:[]),f(Array.isArray(r)?r:[])}catch(s){console.error("Error fetching data:",s),w(s.message)}finally{W(!1)}})()},[]),n.useEffect(()=>{let t=u;d!=="all"&&(t=t.filter(s=>s.status.toLowerCase()===d)),b&&(t=t.filter(s=>s.zpnumber.includes(b))),f(t),g(1)},[d,b,u]),n.useEffect(()=>{f(d==="all"?u:u.filter(t=>t.status.toLowerCase()===d)),g(1)},[d,u]);const ee=v.length,P=Math.ceil(ee/N),z=j*N,T=z-N,te=v.slice(T,z),se=async t=>{Q(t.fullName);try{const s=localStorage.getItem("token");if(!s)throw new Error("No authentication token found");const o=await fetch(`http://192.168.12.245:8594/api/registrations/Memberservicehistory?zp=${t.zpnumber}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);const r=await o.json();console.log("Modal API Response:",r),_(Array.isArray(r)?r:[]),E(!0)}catch(s){console.error("Error fetching member details:",s),w(s.message)}},H=t=>{const s=new Date(t),o=s.getDay(),r=s.getHours(),x=s.getMinutes();if(o===0){if(r>=7&&(r<10||r===10&&x===0))return"First Service";if(r===10&&x>0||r>10&&r<14)return"Second Service"}return o===3&&r>=17&&r<21?"Mid-Week Service":o===1&&r>=18&&r<21?"Youth Service":"Special Service"};return e.jsxs(ie,{className:"mb-4",children:[e.jsx(je,{children:e.jsx("h3",{style:{color:"blue"},children:"Member Status"})}),e.jsxs(fe,{children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-end gap-3",children:[e.jsx(pe,{style:{width:"250px"},placeholder:"Search by ZP Number",value:b,onChange:t=>K(t.target.value)}),e.jsxs(be,{style:{width:"200px"},value:d,onChange:t=>V(t.target.value),children:[e.jsx("option",{style:{fontWeight:"bold"},value:"all",children:"All Members"}),e.jsx("option",{style:{fontWeight:"bold"},value:"active",children:"Active"}),e.jsx("option",{style:{fontWeight:"bold"},value:"inactive",children:"Inactive"})]})]}),G?e.jsxs("div",{className:"text-center",children:[e.jsx(B,{color:"primary"}),e.jsx("p",{children:"Loading members..."})]}):R?e.jsxs("p",{style:{color:"red",textAlign:"center"},children:["Error: ",R]}):v.length===0?e.jsx("p",{style:{textAlign:"center"},children:"Oops seems there are no records."}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"No."}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Full Name"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Mobile Number"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"ZP Number"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Status"}),e.jsx(i,{style:{color:"blue",fontWeight:"bold"},children:"Action"})]})}),e.jsx($,{children:te.map((t,s)=>e.jsxs(M,{children:[e.jsx(a,{style:{fontWeight:"bold",color:"blue"},children:T+s+1}),e.jsx(a,{children:t.fullName}),e.jsx(a,{children:t.mobileNumber}),e.jsx(a,{children:t.zpnumber}),e.jsx(a,{style:{color:t.status.toLowerCase()==="inactive"?"red":"green",fontWeight:"bold"},children:t.status}),e.jsx(a,{children:e.jsx(C,{style:{color:"white",fontWeight:"bold"},color:"success",onClick:()=>se(t),children:"View More"})})]},T+s+1))})]}),e.jsxs(he,{size:"lg",visible:X,onClose:()=>E(!1),children:[e.jsx(ue,{children:e.jsx("strong",{children:"Member History Details"})}),e.jsxs(ge,{style:{maxHeight:"auto",overflowY:"auto"},children:[h.length>0?e.jsx("div",{className:"mb-3",children:q?e.jsxs(C,{disabled:!0,color:"success",style:{color:"#fff"},onClick:k,className:"me-2",children:[e.jsx(B,{size:"sm",color:"light",style:{marginRight:"4px"}}),"Download PDF"]}):e.jsx(C,{color:"success",style:{color:"#fff"},onClick:k,className:"me-2",children:"Download PDF"})}):e.jsx(e.Fragment,{}),h.length>0?e.jsxs(Y,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(i,{children:e.jsx("strong",{children:"Type"})}),e.jsx(i,{children:e.jsx("strong",{children:"Serial Number"})}),e.jsx(i,{children:e.jsx("strong",{children:"Date"})}),e.jsx(i,{children:e.jsx("strong",{children:"Officiating Minister"})}),e.jsx(i,{children:e.jsx("strong",{children:"Service"})})]})}),e.jsx($,{children:h.map((t,s)=>e.jsxs(M,{children:[e.jsx(a,{children:t.type}),e.jsx(a,{children:t.serialNumber}),e.jsx(a,{children:t.datex}),e.jsx(a,{children:t.officiatingMinister}),e.jsx(a,{children:H(t.createdDate)})]},s))})]}):e.jsx("p",{children:"No history records found."})]}),e.jsx(xe,{children:e.jsx(C,{color:"secondary",onClick:()=>E(!1),children:"Close"})})]}),e.jsxs(ye,{align:"center",children:[e.jsx(D,{style:{cursor:"pointer",fontWeight:"bold"},disabled:j===1,onClick:()=>g(t=>Math.max(t-1,1)),children:"Previous"}),Array.from({length:P}).map((t,s)=>e.jsx(D,{style:{cursor:"pointer",fontWeight:"bold"},active:j===s+1,onClick:()=>g(s+1),children:s+1},s)),e.jsx(D,{style:{cursor:"pointer",fontWeight:"bold"},disabled:j===P,onClick:()=>g(t=>Math.min(t+1,P)),children:"Next"})]})]})]})]})}function Ye(){return e.jsx(e.Fragment,{children:e.jsxs(ie,{style:{boxShadow:"0px -2px 19px 1px rgba(0,0,0,0.39)",padding:"15px"},children:[e.jsx(Me,{style:{backgroundColor:"rgba(22, 89, 177, 0.925)"},children:e.jsx("h3",{style:{color:"#fff"},children:"Member Status"})}),e.jsxs(ve,{activeItemKey:"Communion",children:[e.jsxs(we,{variant:"tabs",children:[e.jsx(ae,{itemKey:"Communion",children:"Communion Status"}),e.jsx(ae,{itemKey:"Service",children:"Service Status"})]}),e.jsxs(Ce,{children:[e.jsx(le,{className:"p-3",itemKey:"Communion",style:{backgroundColor:"#fff"},children:e.jsx(Ne,{})}),e.jsx(le,{className:"p-3",itemKey:"Service",style:{backgroundColor:"#fff"},children:e.jsx(Ee,{})})]})]})]})})}export{Ye as default};
