import{r as o,j as e}from"./index-C94lwiJv.js";import{S as C}from"./sweetalert2.all-huutmort.js";import{i as H}from"./zoomies-CYRJWhpg.js";import{C as m,a as d}from"./CRow-Bgj36awN.js";import{c as U,d as G,e as J,o as Z,p as _,q as T,r as u,s as K,t as c,g as Q,h as X,j as Y,k as f,l as ee,m as te}from"./DefaultLayout-BFpOW43o.js";import{C as E,a as I,b as se}from"./CForm-By0H7RBh.js";import{C as V,a as re}from"./index-CynBYxOh.js";import{c as x,b as y,a as oe}from"./CFormInput-ChrqK6Lh.js";import"./LdrsBaseElement-BpkUX6A7.js";import"./index.esm-DV_CLorw.js";import"./CCloseButton-fePu8NsK.js";import"./cil-user-Ddrdy7PS.js";import"./logo1-_GWK0zuy.js";H.register();const je=()=>{const[a,D]=o.useState("registration"),[N,g]=o.useState([]),[l,n]=o.useState({firstName:"",middleName:"",surname:"",nationalId:"",mobile:"",address:"",gender:""}),[le,S]=o.useState(!1);o.useState(""),o.useState(!1);const[P,p]=o.useState(!1),[v,B]=o.useState(1),b=10,[w,W]=o.useState(!1),[F,R]=o.useState(null),h=s=>{const{name:t,value:r}=s.target;if(["firstName","middleName","surname"].includes(t)){/^[A-Za-z]*$/.test(r)&&n({...l,[t]:r});return}if(t==="nationalId"){/^\d*$/.test(r)&&r.length<=8&&n(i=>({...i,nationalId:r}));return}if(t==="mobile"){const i=r.startsWith("+254")?r.replace("+254",""):r;/^\d*$/.test(i)&&i.length<=9&&n(z=>({...z,mobile:"+254"+i}));return}n({...l,[t]:r})},L=s=>{s.preventDefault(),w?fetch(`http://localhost:8080/api/visitors/${F}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(t=>t.json()).then(t=>{g(r=>r.map(i=>i.id===F?t:i)),S(!1),W(!1),C.fire({title:"Updated!",text:"Visitor information updated successfully.",icon:"success",timer:1500,showConfirmButton:!1})}).catch(t=>console.error("Error updating visitor:",t)):fetch("http://localhost:8080/api/visitors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then(t=>t.ok?t.json():t.json().then(r=>{throw new Error(r.message||"Failed to register the visitor.")})).then(t=>{g(r=>[...r,t]),n({fullName:"",mobile:"",address:"",gender:""}),C.fire({title:"Saved!",text:"Visitor Information saved!",icon:"success",timer:1500,timerProgressBar:!0,showConfirmButton:!1,customClass:{popup:"swal-custom-popup",confirmButton:"swal-confirm-button"}})}).catch(t=>{console.error("Error submitting data:",t),C.fire({icon:"error",title:"Oops...",timer:1500,text:"Something went wrong!",footer:'<a href="#">Please try again</a>',timerProgressBar:!0,showConfirmButton:!1})})},M=()=>{p(!0),fetch("http://localhost:8080/api/visitors").then(s=>s.json()).then(s=>{g(s),p(!1)}).catch(s=>{console.error("Error fetching visitors:",s),p(!1)})};o.useEffect(()=>{a==="visitors"&&M()},[a]);const A=s=>{console.log("Assigning card to visitor:",s)},j=s=>{n(s),R(s.id),W(!0),S(!0)},k=v*b,O=k-b,q=N.slice(O,k),$=Math.ceil(N.length/b);return e.jsx(e.Fragment,{children:e.jsx(m,{className:"justify-content-md-center",children:e.jsxs(d,{xs:10,children:[e.jsx(U,{variant:"tabs",style:{marginBottom:"20px"},children:e.jsx(G,{children:e.jsx(J,{href:"#",active:a==="registration",onClick:()=>D("registration"),style:{fontWeight:"bold"},children:"Visitor Registration"})})}),a==="registration"&&e.jsxs(E,{className:"mb-4",style:{boxShadow:"0px 15px 34px 0px rgba(0,0,0,0.2)",color:"blue",padding:"40px",marginTop:"20px"},children:[e.jsx(V,{style:{backgroundColor:"#fff"},children:e.jsx("h3",{color:"blue",fontWeight:"bold",children:"Visitor Registration"})}),e.jsx(I,{children:e.jsxs(se,{onSubmit:L,children:[e.jsx(m,{className:"mb-3",children:e.jsxs(d,{md:"6",children:[e.jsx(x,{htmlFor:"fullName",style:{color:"blue",fontWeight:"bold"},children:"Full Name"}),e.jsx(y,{id:"fullName",name:"fullName",value:l.firstName,onChange:h,placeholder:"Enter Full Name",required:!0})]})}),e.jsxs(m,{className:"mb-3",children:[e.jsxs(d,{md:"6",children:[e.jsx(x,{htmlFor:"mobile",style:{fontWeight:"bold",color:"blue"},children:"Mobile Number"}),e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx("span",{style:{padding:"0.375rem 0.75rem",backgroundColor:"#e6f7ff",border:"1px solid #ced4da",borderRadius:"0.25rem 0 0 0.25rem",color:"#495057",fontWeight:"bold"},children:"+254"}),e.jsx(y,{id:"mobile",name:"mobile",value:l.mobile.replace("+254",""),onChange:h,placeholder:"Enter mobile number",required:!0,maxLength:"9",style:{borderRadius:"0 0.25rem 0.25rem 0"}})]})]}),e.jsxs(d,{md:"6",children:[e.jsx(x,{htmlFor:"address",style:{color:"blue",fontWeight:"bold"},children:"Address"}),e.jsx(y,{id:"address",name:"address",value:l.address,onChange:h,placeholder:"Enter address",required:!0})]})]}),e.jsx(m,{className:"mb-3",children:e.jsxs(d,{md:"6",children:[e.jsx(x,{htmlFor:"gender",style:{color:"blue",fontWeight:"bold"},children:"Gender"}),e.jsxs(re,{id:"gender",name:"gender",value:l.gender,onChange:h,required:!0,children:[e.jsx("option",{value:"",children:"Select gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"})]})]})}),e.jsx(oe,{type:"submit",color:"primary",className:"mt-3",children:w?"Update Visitor":"Register Visitor"})]})})]}),a==="visitors"&&e.jsxs(E,{className:"mb-4",style:{boxShadow:"0px 15px 34px 0px rgba(0,0,0,0.2)",color:"blue",padding:"40px",marginTop:"20px"},children:[e.jsx(V,{children:e.jsx("h3",{color:"blue",fontWeight:"bold",children:"Registered Visitors"})}),e.jsxs(I,{children:[P?e.jsx("div",{className:"text-center",children:e.jsx("l-zoomies",{size:"120",stroke:"5","bg-opacity":"0.1",speed:"1.2",color:"blue"})}):e.jsxs(Z,{striped:!0,children:[e.jsx(_,{children:e.jsxs(T,{children:[e.jsx(u,{style:{fontWeight:"bold",color:"blue"},children:"No."}),e.jsx(u,{style:{fontWeight:"bold",color:"blue"},children:"Full Name"}),e.jsx(u,{style:{fontWeight:"bold",color:"blue"},children:"Mobile"}),e.jsx(u,{style:{fontWeight:"bold",color:"blue"},children:"Gender"})]})}),e.jsx(K,{children:q.map((s,t)=>e.jsxs(T,{children:[e.jsx(c,{children:t+1}),e.jsx(c,{children:s.fullName}),e.jsx(c,{children:s.mobile}),e.jsx(c,{children:s.gender}),e.jsx(c,{children:e.jsxs(Q,{children:[e.jsx(X,{color:"success",style:{color:"#fff",fontWeight:"bold"},children:"Actions"}),e.jsxs(Y,{style:{cursor:"pointer",fontWeight:"bold"},children:[e.jsx(f,{onClick:()=>A(s),style:{fontWeight:"bold"},children:"Link Card"}),e.jsx(f,{onClick:()=>j(s),style:{fontWeight:"bold"},children:"Delink"}),e.jsx(f,{onClick:()=>j(s),style:{fontWeight:"bold"},children:"Edit"}),e.jsx(f,{onClick:()=>j(s),style:{fontWeight:"bold"},children:"Delete"})]})]})})]},s.id))})]}),e.jsx(ee,{align:"center",children:Array.from({length:$},(s,t)=>e.jsx(te,{active:t+1===v,onClick:()=>B(t+1),children:t+1},t))})]})]})]})})})};export{je as default};
