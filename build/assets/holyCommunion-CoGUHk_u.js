import{r as o,j as e,C as ee}from"./index--2Vg46XJ.js";import{S as H}from"./sweetalert2.all-BHDornT5.js";import{C as te,f as I,a as C}from"./index-Bp6JkL8A.js";import{C as se,a as re}from"./CForm-uSoNT2u_.js";import{C as oe}from"./CAlert-CwhgRHPq.js";import{b as ne,a as g}from"./CFormInput-DcpM5UbD.js";import{o as le,p as ae,q as L,r as l,s as ie,t as a,l as ce,m as j}from"./DefaultLayout-JRVaWF0p.js";import{b as de,c as he,d as me,e as ue}from"./logo1-B-TheImU.js";import{C as fe}from"./CFormTextarea-CBhWhc4W.js";import"./CCloseButton-CvX7nGj0.js";import"./index.esm-CI-HiMCL.js";import"./cil-user-Ddrdy7PS.js";function ke(){const[h,W]=o.useState([]),[f,m]=o.useState([]),[B,b]=o.useState(!0),[y,S]=o.useState(""),[i,c]=o.useState(1),[D,u]=o.useState(!1),[v,z]=o.useState(null),[w,G]=o.useState(""),[N,$]=o.useState("7"),[x,O]=o.useState(""),[M,Z]=o.useState(""),[k,q]=o.useState(""),[P,V]=o.useState(!0),p=300;o.useEffect(()=>{(async()=>{b(!0),S("");try{const s=localStorage.getItem("token");if(!s)throw new Error("No token found");const n=await fetch("http://192.168.13.244:8594/api/registrations/holyCommunion",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);const r=await n.json();console.log("API Response:",r),W(Array.isArray(r)?r:[]),m(Array.isArray(r)?r:[])}catch(s){console.error("Error fetching data:",s),S(s.message)}finally{b(!1)}})()},[P]);const J=t=>{const s=t.target.value;if(O(s),s.trim()==="")m(h);else{const n=h.filter(r=>r.zpnumber.toLowerCase().includes(s.toLowerCase()));m(n)}c(1)},A=(t,s,n)=>{let r=h;t.trim()!==""&&(r=r.filter(d=>d.zpnumber.toLowerCase().includes(t.toLowerCase()))),s&&(r=r.filter(d=>d.gender.toLowerCase()===s.toLowerCase())),n&&(r=r.filter(d=>d.district===n)),m(r),c(1)},Y=t=>{Z(t.target.value),A(x,t.target.value,k)},_=t=>{q(t.target.value),A(x,M,t.target.value)},K=t=>{z(t),u(!0)},Q=async()=>{if(v)try{const t=localStorage.getItem("token");if(!t)throw new Error("No token found");const s={id:v.id,status:Number(N),comments:w},n=await fetch("http://192.168.13.244:8594/api/registrations/approvetransfer",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(s)});if(!n.ok){const r=await n.json();throw new Error(r.message||"Failed to update Holy Communion status.")}H.fire({title:"Success!",text:"Holy Communion status updated successfully.",icon:"success",timer:2e3,showConfirmButton:!1}),u(!1),V(!P)}catch(t){console.error("Error submitting request:",t),H.fire("Error",t.message||"Failed to update Holy Communion status.","error")}},U=f.length,E=Math.ceil(U/p),T=i*p,F=T-p,X=f.slice(F,T),R=localStorage.getItem("roleId");return e.jsxs(e.Fragment,{children:[e.jsxs(se,{className:"mb-4",style:{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.2)"},children:[e.jsx(te,{className:"mt-2",children:e.jsxs(oe,{color:"primary",variant:"solid",style:{display:"flex",alignItems:"center"},children:[e.jsx(I,{style:{marginRight:"8px",fontSize:"40"}}),e.jsx("h3",{style:{color:"#fff"},children:"Holy Communion"})]})}),e.jsxs(re,{children:[e.jsxs("div",{className:"mb-3 d-flex justify-content-end align-items-center gap-3",children:[e.jsx(ne,{type:"text",placeholder:"Search by ZP Number",value:x,onChange:J}),e.jsxs(C,{value:M,onChange:Y,children:[e.jsx("option",{style:{fontWeight:"bold"},value:"",children:"All Genders"}),e.jsx("option",{style:{fontWeight:"bold"},value:"Male",children:"Male"}),e.jsx("option",{style:{fontWeight:"bold"},value:"Female",children:"Female"})]}),e.jsxs(C,{value:k,onChange:_,children:[e.jsx("option",{value:"",children:"All Districts"}),[...new Set(h.map(t=>t.district))].map(t=>e.jsx("option",{value:t,children:t},t))]})]}),B?e.jsxs("div",{className:"text-center",children:[e.jsx(ee,{color:"primary"}),e.jsx("p",{children:"Loading members..."})]}):y?e.jsxs("p",{style:{color:"red",textAlign:"center"},children:["Error: ",y]}):f.length===0?e.jsx("p",{style:{textAlign:"center"},children:"No member records found."}):e.jsxs(e.Fragment,{children:[e.jsxs(le,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(ae,{children:e.jsxs(L,{color:"primary",children:[e.jsx(l,{children:"No."}),e.jsx(l,{children:"Full Name"}),e.jsx(l,{children:"Mobile Number"}),e.jsx(l,{children:"ZP Number"}),e.jsx(l,{children:"Districts"}),e.jsx(l,{children:"Gender"}),R=="1"?null:e.jsx(l,{children:"Action"})]})}),e.jsx(ie,{children:X.map((t,s)=>e.jsxs(L,{children:[e.jsx(a,{style:{fontWeight:"bold",color:"blue"},children:F+s+1}),e.jsx(a,{children:t.fullName}),e.jsx(a,{children:t.mobileNumber}),e.jsx(a,{children:t.zpnumber}),e.jsx(a,{children:t.district}),e.jsx(a,{children:t.gender}),e.jsx(a,{children:R=="1"?null:e.jsxs(g,{style:{color:"white",fontWeight:"bold"},color:"success",onClick:()=>K(t),children:[e.jsx(I,{style:{marginRight:"4px",fontSize:"20"}})," Stop Communion"]})})]},s))})]}),e.jsxs(ce,{className:"mt-3 justify-content-center",children:[e.jsx(j,{style:{cursor:"pointer",fontWeight:"bold"},disabled:i===1,onClick:()=>c(i-1),children:"Previous"}),Array.from({length:E},(t,s)=>e.jsx(j,{style:{fontWeight:"bold",cursor:"pointer"},active:s+1===i,onClick:()=>c(s+1),children:s+1},s+1)),e.jsx(j,{style:{fontWeight:"bold",cursor:"pointer"},disabled:i===E,onClick:()=>c(i+1),children:"Next"})]})]})]})]}),e.jsxs(de,{visible:D,onClose:()=>u(!1),children:[e.jsx(he,{children:"Stop Holy Communion"}),e.jsxs(me,{children:[e.jsx(C,{label:"Status",className:"mb-3",value:N,onChange:t=>$(t.target.value),children:e.jsx("option",{value:"7",children:"Yes"})}),e.jsx(fe,{label:"comments",className:"mb-3",value:w,onChange:t=>G(t.target.value),placeholder:"Enter comments"})]}),e.jsxs(ue,{children:[e.jsx(g,{color:"secondary",onClick:()=>u(!1),children:"Cancel"}),e.jsx(g,{style:{color:"white",fontWeight:"bold"},color:"success",onClick:Q,children:"Confirm"})]})]})]})}export{ke as default};
