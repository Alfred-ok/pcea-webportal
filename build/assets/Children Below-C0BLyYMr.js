import{r as d,j as e,C as A}from"./index--2Vg46XJ.js";import{S as u}from"./sweetalert2.all-BHDornT5.js";import{D as x}from"./Districtdata-DjCRdM62.js";import{Z as F}from"./Zones-CmHuVysO.js";import{C as W,M,a as S}from"./index-Bp6JkL8A.js";import{C as J,a as Z,b as G}from"./CForm-uSoNT2u_.js";import{C as H}from"./CAlert-CwhgRHPq.js";import{C as l,a as f}from"./CRow-BUZD3U73.js";import{c as p,b as j,a as O}from"./CFormInput-DcpM5UbD.js";import{C as D,a as N}from"./CInputGroupText-Bft_3Juj.js";import"./CCloseButton-CvX7nGj0.js";const se=()=>{const[h,z]=d.useState(""),[P,C]=d.useState([]),[T,I]=d.useState(""),[L,g]=d.useState(!1),[o,m]=d.useState({gender:"",names:"",yearOfBirth:"",disabled:"",disabilityType:"",email:"",telephone:"",guardianPhone:"",yearOfBirth:"",district:"",zone:h,age:"",baptized:"",communicant:"",dateOfBaptism:"",baptizedBy:"",communicantNumber:"",dateOfConfirmation:"",confirmedBy:"",confirmationLocation:"",yearOfJoining:"",address:"",passportPhoto:null,membershipType:"Full",transferLetter:null,communionForm:null,teenager:""});d.useState([]);const[v,k]=d.useState([]);d.useEffect(()=>{(()=>{const t=new Date().getFullYear(),n=Array.from({length:t-1969},(s,i)=>1970+i);k(n)})()},[]);const Y=r=>{const t=r.target.value;I(t),m(s=>({...s,district:t}));const n=x.find(s=>s.district===t);if(n){const s=F.find(c=>c.zoneId===n.zoneId),i=s?s.zone:"";z(i),m(c=>({...c,zone:i}))}else z(""),m(s=>({...s,zone:""}))};d.useEffect(()=>{if(h){const r=F.find(n=>n.zone===h),t=r?r.zoneId:null;if(t){const n=x.filter(s=>s.zoneId===t);C(n)}else C([])}else C(x)},[h]);const b=({target:{name:r,value:t,type:n}})=>{m(s=>({...s,[r]:n==="checkbox"?t==="on":t}))},E=({target:{name:r,files:t}})=>{const n=t[0];if(n){const s=new FileReader;s.readAsDataURL(n),s.onload=()=>{const i=s.result.split(",")[1];m(c=>({...c,[r]:i}))},s.onerror=i=>{console.error("Error converting file to Base64:",i),u.fire("Error","Failed to process file. Please try again.","error")}}};console.log(o);const R=async r=>{r.preventDefault();const t=localStorage.getItem("token");if(!t){u.fire("Error","User is not authenticated. Please log in.","error");return}const{passportPhoto:n,transferLetter:s,communionForm:i,...c}=o,B={...c,passportPhoto:n||null,transferLetter:s||null,communionForm:i||null,telephone:`+254${o.guardianPhone}`};console.log(B),g(!0);try{const y=await fetch("http://192.168.13.244:8594/api/registrations/teenager",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(B)});if(y.ok)u.fire("Success!","Registration data submitted successfully.","success"),m({names:"",email:"",age:"",yearOfBirth:"",disabled:"",disabilityType:"",telephone:"",guardianPhone:"",yearOfBirth:"",district:"",zone:"",baptized:"",communicant:"",gender:"",dateOfBaptism:"",baptizedBy:"",communicantNumber:"",dateOfConfirmation:"",confirmedBy:"",confirmationLocation:"",yearOfJoining:"",address:"",passportPhoto:null,membershipType:"Full",transferLetter:null,communionForm:null,teenager:""}),g(!1);else{const w=await y.json();u.fire("Error",w.message||"Failed to submit registration data.","error"),g(!1)}}catch(y){console.error("Error submitting registration:",y),u.fire("Error","Failed to submit registration data. Please try again.","error"),g(!1)}},a=(r,t,n="text",s)=>e.jsxs(f,{md:"6",children:[e.jsx(p,{style:{fontWeight:"bold",color:"blue"},children:r}),n==="select"&&(s||!0)?e.jsxs(S,{name:t,value:o[t],onChange:b,required:!0,children:[e.jsxs("option",{value:"",children:["Select ",r]}),(s||P).map((i,c)=>e.jsx("option",{value:i.district||i.zoneName||i.districtName||i,children:i.district||i.zoneName||i.districtName||i},c))]}):e.jsx(j,{name:t,type:n,value:n!=="file"?o[t]:void 0,onChange:n==="file"?E:b,required:n!=="file"})]});return e.jsxs(J,{className:"mb-4",children:[e.jsx(W,{children:e.jsxs(H,{color:"primary",variant:"solid",style:{display:"flex",alignItems:"center"},children:[e.jsx(M,{style:{marginRight:"8px",fontSize:"40"}}),e.jsx("h3",{className:"fw-bold",style:{color:"#fff"},children:"Teenager Registration"})]})}),e.jsx(Z,{children:e.jsxs(G,{onSubmit:R,children:[e.jsxs(l,{children:[a("Full Name","names"),a("Gender","gender","select",["Male","Female"]),a("Email","email")]}),e.jsx(l,{children:e.jsxs(f,{md:"6",children:[e.jsx(p,{style:{fontWeight:"bold",color:"blue"},children:"Telephone"}),e.jsxs(D,{children:[e.jsx(N,{children:"+254"}),e.jsx(j,{name:"telephone",type:"text",value:o.telephone,onChange:b,maxLength:"9"})]})]})}),e.jsxs(l,{children:[e.jsxs(f,{md:"6",children:[e.jsx(p,{style:{fontWeight:"bold",color:"blue"},children:"Guardian Telephone"}),e.jsxs(D,{children:[e.jsx(N,{children:"+254"}),e.jsx(j,{name:"guardianPhone",type:"text",value:o.guardianPhone,onChange:b,maxLength:"9"})]})]}),a("Year of Birth","yearOfBirth","select",v)]}),e.jsxs(l,{children:[e.jsxs(f,{md:"6",children:[e.jsx(p,{style:{color:"blue",fontWeight:"bold"},children:"* District:"}),e.jsxs(S,{value:T,onChange:Y,children:[e.jsx("option",{value:"",children:"Select District"}),x.map(r=>e.jsx("option",{value:r.district,children:r.district},r.id))]})]}),e.jsxs(f,{md:"6",children:[e.jsx(p,{style:{fontWeight:"bold",color:"blue"},children:"* Zone"}),e.jsx(j,{type:"text",value:h,readOnly:!0})]})]}),e.jsxs(l,{children:[a("Membership Type","membershipType","select",["New","Adherent","Transfer"]),a("Baptized?","baptized","select",["Yes","No"]),a("Communicant?","communicant","select",["Yes","No"])]}),o.baptized==="Yes"&&e.jsx(l,{children:[{label:"Date of Baptism",key:"dateOfBaptism"},{label:"Baptized By",key:"baptizedBy"}].map(({label:r,key:t})=>a(r,t))}),o.communicant==="Yes"&&e.jsx(l,{children:[{label:"Communicant Number",key:"communicantNumber"},{label:"Date of Confirmation",key:"dateOfConfirmation"},{label:"Confirmed By",key:"confirmedBy"},{label:"Confirmation Location",key:"confirmationLocation"}].map(({label:r,key:t})=>a(r,t))}),e.jsxs(l,{children:[a("Year of Joining","yearOfJoining"),a("Address","address")]}),e.jsxs(l,{children:[a("Disabled","disabled","select",["Yes","No"]),o.disabled==="Yes"&&e.jsx(e.Fragment,{children:a("Disability Type","disabilityType","select",["Intellectual Disability","Mental Health","Chronic Illness","Learning Disability","Mobility Impairment","Hearing Impairment","Visual Impairment","Others"])})]}),e.jsx(l,{children:[{label:"Passport Photo",key:"passportPhoto"},{label:"Transfer Letter",key:"transferLetter"},{label:"Communion Form",key:"communionForm"}].map(({label:r,key:t})=>a(r,t,"file"))}),e.jsx("div",{className:"mt-4",children:L?e.jsxs(O,{color:"primary",disabled:!0,style:{fontWeight:"bold"},children:[e.jsx(A,{as:"span",className:"me-2",size:"sm","aria-hidden":"true"}),e.jsx("span",{children:"Register..."})]}):e.jsx(O,{style:{fontWeight:"bold"},color:"primary",type:"submit",children:"Register"})})]})})]})};export{se as default};
