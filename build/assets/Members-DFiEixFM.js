import{j as e,r as l,C as me}from"./index--2Vg46XJ.js";import{C as V,d as he}from"./index-Bp6JkL8A.js";import{F as pe,G as ge,H as z,c as xe,d as ue,e as je,o as fe,p as Ce,q as K,r as G,s as ye,t as u}from"./DefaultLayout-JRVaWF0p.js";import{E as Te,a as Se}from"./jspdf.plugin.autotable-xBXH9STM.js";import{l as ve,b as $,c as H,d as Q,e as _}from"./logo1-B-TheImU.js";import{C as O,a as b}from"./CForm-uSoNT2u_.js";import{C as ee}from"./CCardTitle-Bhw-tENH.js";import{C as Ne,a as M}from"./CRow-BUZD3U73.js";import{C as Y,a as o}from"./CListGroupItem-Dl75QF8E.js";import{a as i}from"./CFormInput-DcpM5UbD.js";import{C as Ae}from"./CAlert-CwhgRHPq.js";import{C as Ee}from"./CFormCheck-DFANe7fa.js";import{C as w}from"./CModalTitle-Bc9MZI4H.js";import{C as D}from"./CFormTextarea-CBhWhc4W.js";import"./index.esm-CI-HiMCL.js";import"./CCloseButton-CvX7nGj0.js";import"./cil-user-Ddrdy7PS.js";import"./typeof-QjJsDpFa.js";const Pe=({viewMoreVisibleData:t})=>{const C=t.passportPhoto,y={width:"300px",height:"300px",backgroundImage:`url("data:image/jpeg;base64,${C}")`,backgroundRepeat:"no-repeat",backgroundSize:"cover",marginTop:"8px",objectFit:"cover",overflow:"hidden"},A=async()=>{const a=new Te("p","mm","a4"),E=10,j=a.internal.pageSize.getWidth(),f=c=>new Promise((m,h)=>{const d=new Image;d.crossOrigin="Anonymous",d.src=c,d.onload=()=>{const n=document.createElement("canvas");n.width=d.width,n.height=d.height,n.getContext("2d").drawImage(d,0,0),m(n.toDataURL("image/png"))},d.onerror=n=>h(n)});try{const c=await f(ve),m=30,h=30,d=(j-m)/2;let n=E;a.addImage(c,"PNG",d,n,m,h),n+=h+10,a.setFontSize(14),a.setFont("helvetica","bold"),a.text("PCEA ZIMMERMAN MEMBER REPORT",j/2,n,{align:"center"}),n+=10,a.setLineWidth(.5),a.line(20,n,190,n),n+=10,a.setFont("helvetica","bold"),a.setFontSize(20);const T=j/2,x=n+10;a.text(t.names||"Member",T,x,{align:"center"}),a.setFontSize(14),a.setFont("helvetica","italic"),a.text("Member",T,x+8,{align:"center"});const S=40,p=40,v=(j-S)/2,P=x+15;C&&a.addImage(`data:image/jpeg;base64,${C}`,"JPEG",v,P,S,p),n=P+p+10,a.setLineWidth(.5),a.line(20,n,190,n),n+=10,a.setFontSize(16),a.setFont("helvetica","bold"),a.text("Details",20,n),n+=5,Se(a,{startY:n+5,head:[["Field","Value"]],body:[["Email",t.email],["Phone",t.telephone],["Address",t.address],["District",t.district],["Guardian Phone",t.guardianPhone],["Spouse Name",t.spouseName||"-"],["Marital Status",t.maritalStatus||"-"],["Spouse Zp",t.spouseZp||"-"],["Marriage Type",t.marriageType||"-"],["Teenager",t.teenager||"-"],["Membership Type",t.membershipType||"-"],["Year of Birth",t.yearOfBirth||"-"],["Zone",t.zone||"-"],["Baptized",t.baptized||"-"],["Baptized By",t.baptizedBy||"-"],["Comments",t.comments||"-"],["Gender",t.gender||"-"],["Communicant",t.communicant||"-"],["Communicant Number",t.communicantNumber||"-"],["Confirmation Location",t.confirmationLocation||"-"],["Confirmed By",t.confirmedBy||"-"],["Date Of Baptism",t.dateOfBaptism||"-"],["Date of Confirmation",t.dateOfConfirmation||"-"],["Disability Type",t.disabilityType||"-"],["Disabled",t.disabled||"-"],["Id",t.id||"-"],["Year of Joining",t.yearOfJoining||"-"]],theme:"grid",headStyles:{fillColor:[41,128,185],textColor:255},alternateRowStyles:{fillColor:[240,240,240]}}),a.save("Member Details.pdf")}catch(c){console.error("Error loading images:",c)}};return e.jsx("div",{className:"container mt-2",children:e.jsxs(O,{className:"p-4 shadow-lg",children:[e.jsxs(V,{className:"bg-primary text-white text-center",children:[e.jsx(ee,{className:"h3 mb-0",children:t.names}),e.jsx("p",{children:"Member"})]}),e.jsxs(b,{children:[e.jsxs(Ne,{children:[e.jsxs(M,{md:4,children:[e.jsx("h5",{children:"Contact Information"}),e.jsxs(Y,{children:[t.email&&e.jsxs(o,{children:[e.jsx(pe,{})," Email: ",t.email]}),t.telephone&&e.jsxs(o,{children:[e.jsx(ge,{})," Telephone: ",t.telephone]}),t.address&&e.jsxs(o,{children:[e.jsx(z,{})," Address: ",t.address]}),t.district&&e.jsxs(o,{children:[e.jsx(z,{})," District: ",t.district]}),t.guardianPhone&&e.jsxs(o,{children:[e.jsx(z,{})," Guardian Phone: ",t.guardianPhone]}),t.passportPhoto&&e.jsxs(o,{children:[e.jsx(z,{}),"Passport :",e.jsx("div",{style:y})]})]})]}),e.jsxs(M,{md:8,children:[e.jsx("h5",{children:"Family"}),e.jsx(O,{className:"mb-3",children:e.jsx(b,{children:e.jsxs(Y,{flush:!0,children:[t.spouseName&&e.jsxs(o,{children:[e.jsx("strong",{children:"Spouse Name :"})," ",t.spouseName]}),t.spouseZp&&e.jsxs(o,{children:[e.jsx("strong",{children:"Spouse Zp :"})," ",t.spouseZp]}),t.maritalStatus&&e.jsxs(o,{children:[e.jsx("strong",{children:"Marital Status :"})," ",t.maritalStatus]}),t.marriageType&&e.jsxs(o,{children:[e.jsx("strong",{children:"Marriage Type :"})," ",t.marriageType]}),t.teenager&&e.jsxs(o,{children:[e.jsx("strong",{children:"Teenager :"})," ",t.teenager]})]})})}),e.jsx("h5",{children:"Other Details"}),e.jsx(O,{className:"mb-3",children:e.jsx(b,{children:e.jsxs(Y,{flush:!0,children:[t.baptized&&e.jsxs(o,{children:[e.jsx("strong",{children:"Baptised"})," ",t.baptized]}),t.baptizedBy&&e.jsxs(o,{children:[e.jsx("strong",{children:"Baptised By:"})," ",t.baptizedBy]}),t.comments&&e.jsxs(o,{children:[e.jsx("strong",{children:"Comments :"})," ",t.comments]}),t.communicant&&e.jsxs(o,{children:[e.jsx("strong",{children:"Communicant :"})," ",t.communicant]}),t.communicantNumber&&e.jsxs(o,{children:[e.jsx("strong",{children:"Communicant Number:"})," ",t.communicantNumber]}),t.confirmationLocation&&e.jsxs(o,{children:[e.jsx("strong",{children:"Location :"})," ",t.confirmationLocation]}),t.confirmedBy&&e.jsxs(o,{children:[e.jsx("strong",{children:"Confirmed By :"})," ",t.confirmedBy]}),t.dateOfBaptism&&e.jsxs(o,{children:[e.jsx("strong",{children:"Date Of Baptism :"})," ",t.dateOfBaptism]}),t.dateOfConfirmation&&e.jsxs(o,{children:[e.jsx("strong",{children:"Date Of Confirmation :"})," ",t.dateOfConfirmation]}),t.disabilityType&&e.jsxs(o,{children:[e.jsx("strong",{children:"Disability Type :"})," ",t.disabilityType]}),t.disabled&&e.jsxs(o,{children:[e.jsx("strong",{children:"Disabled :"})," ",t.disabled]}),t.id&&e.jsxs(o,{children:[e.jsx("strong",{children:"Id :"})," ",t.id]}),t.membershipType&&e.jsxs(o,{children:[e.jsx("strong",{children:"Membership Type :"})," ",t.membershipType]}),t.gender&&e.jsxs(o,{children:[e.jsx("strong",{children:"Gender :"})," ",t.gender]}),t.teenager&&e.jsxs(o,{children:[e.jsx("strong",{children:"Teenager :"})," ",t.teenager]}),t.yearOfBirth&&e.jsxs(o,{children:[e.jsx("strong",{children:"Year Of Birth :"})," ",t.yearOfBirth]}),t.yearOfJoining&&e.jsxs(o,{children:[e.jsx("strong",{children:"Year Of Joining :"})," ",t.yearOfJoining]}),t.zone&&e.jsxs(o,{children:[e.jsx("strong",{children:"Zone :"})," ",t.zone]})]})})})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx(i,{color:"primary",onClick:A,className:"mt-3",children:"Download Member Details"})})]})]})})},Ue=()=>{const[t,C]=l.useState("movedToEvangelist"),[y,A]=l.useState({movedToPastoral:[],movedToEvangelist:[],movedToCatechism:[]}),[a,E]=l.useState(!1),[j,f]=l.useState(!1),[c,m]=l.useState(""),[h,d]=l.useState(null),[n,T]=l.useState(""),[x,S]=l.useState(!0),[p,v]=l.useState([]),[P,J]=l.useState(!1),[I,te]=l.useState(),[se,B]=l.useState(!1),[F,R]=l.useState(""),[Z,oe]=l.useState(""),[ne,W]=l.useState(!1),X=localStorage.getItem("roleId");l.useEffect(()=>{const s=async(r,g)=>{E(!0);try{const k=localStorage.getItem("token");if(!k)throw new Error("No token found");const N=await fetch(g,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`}});if(!N.ok)throw new Error(`HTTP error! Status: ${N.status}`);const U=await N.json();A(ie=>({...ie,[r]:Array.isArray(U)?U:[]})),v([])}catch(k){console.error(`Error fetching ${r} members:`,k),A(N=>({...N,[r]:[]}))}finally{E(!1)}};s("movedToPastoral","http://192.168.13.244:8594/api/registrations/byStatus?status=4"),s("movedToEvangelist","http://192.168.13.244:8594/api/registrations/byStatus?status=3"),s("movedToCatechism","http://192.168.13.244:8594/api/registrations/byStatus?status=6")},[x]);const L=X=="1"?"":"Approval",re={movedToPastoral:["Full Name","District","Gender","Telephone",L],movedToEvangelist:["Full Name","District","Gender","Telephone",L],movedToCatechism:["Full Name","District","Gender","Telephone",L]},ae=s=>{v(r=>r.includes(s)?r.filter(g=>g!==s):[...r,s])},le=s=>{s&&(te(s),J(!0))};console.log(I);const ce=s=>{const r=y[t].find(g=>g.id===s);r&&(d(r),f(!0))},de=async()=>{if(!h||!c){alert("Please select a registration status.");return}const s={id:h.id,status:c,comments:n};try{const r=localStorage.getItem("token");if(!r)throw new Error("No token found");if(!(await fetch("http://192.168.13.244:8594/api/registrations/approve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(s)})).ok)throw new Error("Failed to update status");alert("Status updated successfully!"),f(!1),S(!x)}catch(r){console.error("Error updating status:",r),alert("Error updating status. Please try again.")}},q=async()=>{if(p.length===0){alert("No members selected.");return}const s=p.map(r=>({id:r,status:F,comments:Z}));console.log("end",s),W(!0);try{const r=localStorage.getItem("token");if(!r)throw new Error("No token found");await Promise.all(s.map(g=>fetch("http://192.168.13.244:8594/api/registrations/approve",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(g)}))),W(!1),B(!1),S(!x),v([]),alert("All selected members approved!")}catch(r){console.error("Error approving all:",r),alert("Error approving all. Please try again."),W(!1)}};return console.log("start",p),console.log(y),e.jsxs(O,{className:"mb-4",children:[e.jsx(V,{children:e.jsx(ee,{children:e.jsxs(Ae,{color:"primary",variant:"solid",style:{display:"flex"},children:[e.jsx(he,{size:40,className:"nav-icon",style:{marginRight:"10px"}}),e.jsx("h3",{children:"New Applicant"})]})})}),e.jsxs(b,{children:[e.jsx(xe,{variant:"tabs",children:["movedToEvangelist","movedToPastoral","movedToCatechism"].map(s=>e.jsx(ue,{children:e.jsx(je,{active:t===s,onClick:()=>C(s),style:{cursor:"pointer",fontWeight:"bold"},children:s==="movedToEvangelist"?"Moved to Evangelist":s==="movedToPastoral"?"Moved to Pastoral":"Moved to Catechism"})},s))}),a?e.jsxs("div",{className:"text-center",children:[e.jsx("l-zoomies",{size:"120",stroke:"5","bg-opacity":"0.1",speed:"1.4",color:"blue"}),e.jsx("p",{children:"Loading data..."})]}):e.jsxs(e.Fragment,{children:[p.length!==0&&e.jsx(i,{color:"success",style:{marginBottom:"10px",fontWeight:"bold",color:"#fff",marginTop:"10px"},onClick:()=>B(!0),children:"Approve All"}),e.jsxs(fe,{striped:!0,bordered:!0,hover:!0,children:[e.jsx(Ce,{children:e.jsxs(K,{color:"primary",children:[e.jsx(G,{style:{color:"blue",fontWeight:"bold"},children:"#"}),e.jsx(G,{style:{color:"blue",fontWeight:"bold"},children:"No."}),re[t].map(s=>e.jsx(G,{style:{color:"blue",fontWeight:"bold"},children:s},s))]})}),e.jsx(ye,{children:y[t].map((s,r)=>e.jsxs(K,{children:[e.jsx(u,{children:e.jsx(Ee,{checked:p.includes(s.id),onChange:()=>ae(s.id)})}),e.jsx(u,{children:r+1}),e.jsx(u,{children:s.names}),e.jsx(u,{children:s.district}),e.jsx(u,{children:s.gender}),e.jsx(u,{children:s.telephone}),(t==="movedToPastoral"||t==="movedToEvangelist"||t==="movedToCatechism")&&e.jsx(u,{children:X=="1"?e.jsx(e.Fragment,{}):e.jsxs(e.Fragment,{children:[e.jsx(i,{style:{color:"white",fontWeight:"bold",marginRight:"5px"},color:"success",onClick:()=>ce(s.id),children:"Approve"}),e.jsx(i,{style:{color:"white",fontWeight:"bold"},color:"primary",onClick:()=>le(s),children:"View More"})]})})]},s.id))})]})]}),e.jsxs($,{visible:j,onClose:()=>f(!1),children:[e.jsx(H,{children:e.jsx(w,{children:"Approval Details"})}),e.jsx(Q,{style:{maxHeight:"60vh",overflowY:"auto"},children:h&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"registrationStatus",className:"mt-2",style:{fontWeight:"bold",color:"blue"},children:"Approve Registration:"}),t==="movedToEvangelist"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:c,onChange:s=>m(s.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:t==="movedToEvangelist"?"4":"5",children:"Moved To Pastoral"})]}):t==="movedToPastoral"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:c,onChange:s=>m(s.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:t==="movedToEvangelist"?"4":"5",children:"Move to Full Member awaiting Admission"}),e.jsx("option",{value:t==="movedToEvangelist"?"2":t==="movedToPastoral"?"6":"5",children:"Moved To Catechism"})]}):t==="movedToCatechism"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:c,onChange:s=>m(s.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:t==="movedToEvangelist"?"4":"5",children:"Move to Full Member awaiting Admission"})]}):e.jsx(e.Fragment,{children:"Action Disabled"}),e.jsx(D,{className:"mt-2",placeholder:"Add a comment",value:n,onChange:s=>T(s.target.value)})]})}),e.jsxs(_,{children:[e.jsx(i,{color:"secondary",onClick:()=>f(!1),children:"Close"}),e.jsx(i,{color:"success",onClick:de,children:"Confirm"})]})]}),e.jsxs($,{visible:P,onClose:()=>J(!1),"aria-labelledby":"LiveDemoExampleLabel",size:"xl",alignment:"center",backdrop:"static",children:[e.jsx(H,{}),I&&e.jsx(Pe,{viewMoreVisibleData:I})]}),e.jsxs($,{visible:se,onClose:()=>B(!1),children:[e.jsx(H,{children:e.jsx(w,{children:"Approval All Details"})}),e.jsx(Q,{style:{maxHeight:"60vh",overflowY:"auto"},children:e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"registrationStatus",className:"mt-2",style:{fontWeight:"bold",color:"blue"},children:"Approval All Details"}),t==="movedToEvangelist"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:F,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:t==="movedToEvangelist"?"4":"5",children:"Moved To Pastoral"})]}):t==="movedToPastoral"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:F,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:t==="movedToEvangelist"?"4":"5",children:"Move to Full Member awaiting Admission"}),e.jsx("option",{value:t==="movedToEvangelist"?"2":t==="movedToPastoral"?"6":"5",children:"Moved To Catechism"})]}):t==="movedToCatechism"?e.jsxs("select",{id:"registrationStatus",className:"form-control mt-2",value:F,onChange:s=>R(s.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:t==="movedToEvangelist"?"4":"5",children:"Move to Full Member awaiting Admission"})]}):e.jsx(e.Fragment,{children:"Action Disabled"}),e.jsx(D,{className:"mt-2",placeholder:"Add a comment",value:Z,onChange:s=>oe(s.target.value)})]})}),e.jsxs(_,{children:[e.jsx(i,{color:"secondary",onClick:()=>B(!1),children:"Close"}),ne?e.jsxs(i,{color:"primary",disabled:!0,onClick:q,style:{fontWeight:"bold"},children:[e.jsx(me,{as:"span",className:"me-2",size:"sm","aria-hidden":"true"}),e.jsx("span",{children:"Confirm..."})]}):e.jsx(i,{style:{fontWeight:"bold"},onClick:q,color:"primary",type:"submit",children:"Confirm"})]})]})]})]})};export{Ue as default};
